@{
    ViewBag.Title = "Accueil - Opticien";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Section d'introduction (Hero Section) -->
<div class="jumbotron text-center bg-white p-5 my-5 rounded-lg shadow-sm border-0">
    @* jumbotron pour un look classique, p-5 pour un bon padding, my-5 pour espacer, rounded-lg pour des coins arrondis, shadow-sm pour une légère ombre *@
    <h1 class="display-4 fw-bold mb-3" style="color: var(--primary-color);">Bienvenue dans l'application Opticien</h1> @* fw-bold pour font-weight-bold, mb-3 pour l'espacement *@
    <p class="lead" style="color: var(--secondary-color);">Gérez facilement vos clients, ordonnances, produits, ventes et paiements. Une solution complète et intuitive.</p> @* text-secondary pour une couleur plus douce *@
    <hr class="my-4 w-50 mx-auto" style="border-color: var(--accent-color); opacity: 0.5;"> @* Ligne de séparation plus courte, centrée, colorée et semi-transparente *@
    <p class="text-muted">Optimisez la gestion de votre point de vente et améliorez l'expérience client.</p>
    <div class="mt-4">
        @Html.ActionLink("Démarrer la Gestion", "Index", "Client", null, new { @class = "btn btn-lg shadow-sm", style = "background-color: var(--accent-color); border-color: var(--accent-color); color: white;" }) @* Bouton principal, plus grand, avec ombre *@
        @Html.ActionLink("Explorer les Fonctionnalités", "About", "Home", null, new { @class = "btn btn-outline-secondary btn-lg ms-3" }) @* Bouton secondaire, outline, espacé *@
    </div>
</div>

<!-- Statistiques principales (Cards Section) -->
<h2 class="text-center fw-bold mb-4" style="color: var(--primary-color);">Statistiques Clés</h2> @* Titre de section plus impactant *@
<div class="row row-cols-1 row-cols-md-3 g-4 mb-5">
    @* row-cols-1 et row-cols-md-3 pour le responsive, g-4 pour l'espacement entre les colonnes *@
    <div class="col">
        <div class="card h-100 shadow-sm rounded-lg border-0 hover-card">
            @* Card, shadow plus prononcée, pas de bordure par défaut *@
            <div class="card-body text-center d-flex flex-column justify-content-between">
                <h3 class="card-title mb-3" style="color: var(--accent-color);">Clients</h3> @* Titre dans la carte *@
                <p class="card-text display-4 fw-bold" style="color: var(--primary-color);">@ViewBag.TotalClients</p> @* fs-2 pour une taille de police très grande pour le nombre, fw-bold pour gras *@
                <p class="text-muted mb-4">clients enregistrés.</p> @* texte descriptif muted *@
                @Html.ActionLink("Gérer les clients", "Index", "Client", null, new { @class = "btn btn-sm mt-auto", style = "border-color: var(--accent-color); color: var(--accent-color);" }) @* btn-sm pour un bouton plus petit ici *@
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card h-100 shadow-sm rounded-lg border-0 hover-card">
            <div class="card-body text-center d-flex flex-column justify-content-between">
                <h3 class="card-title mb-3" style="color: var(--accent-color);">Produits</h3>
                <p class="card-text display-4 fw-bold" style="color: var(--primary-color);">@ViewBag.ActiveProducts</p>
                <p class="text-muted mb-4">produits actifs dans votre catalogue.</p>
                @Html.ActionLink("Gérer les produits", "Index", "Produit", null, new { @class = "btn btn-sm mt-auto", style = "border-color: var(--accent-color); color: var(--accent-color);" })
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card h-100 shadow-sm rounded-lg border-0 hover-card">
            <div class="card-body text-center d-flex flex-column justify-content-between">
                <h3 class="card-title mb-3" style="color: var(--accent-color);">Ordonnances</h3>
                <p class="card-text display-4 fw-bold" style="color: var(--primary-color);">@ViewBag.ValidOrdonnances</p>
                <p class="text-muted mb-4">ordonnances valides actuellement.</p>
                @Html.ActionLink("Gérer les ventes", "Index", "OperationVente", null, new { @class = "btn btn-sm mt-auto", style = "border-color: var(--accent-color); color: var(--accent-color);" })
            </div>
        </div>
    </div>
</div>

<!-- Section des dernières ventes (Table Section) -->
@{
    var lastSales = ViewBag.LastSales as List<OpticienMvcApp.OperationVente>;
}

<h2 class="text-center fw-bold mb-4" style="color: var(--primary-color);">Dernières Opérations de Vente</h2> @* Titre de section plus impactant *@

@if (lastSales != null && lastSales.Any())
{
    <div class="table-responsive shadow-sm rounded-lg overflow-hidden">
        @* shadow-sm et rounded-lg pour la table, overflow-hidden pour que les coins arrondis fonctionnent avec table-responsive *@
        <table class="table table-hover mb-0">
            @* Supprimé table-bordered pour un look plus moderne, mb-0 pour retirer la marge par défaut *@
            <thead style="background-color: var(--primary-color);">
                @* En-tête de tableau avec la couleur principale *@
                <tr>
                    <th scope="col" class="p-3 text-white">Numéro Op.</th> @* p-3 pour un padding plus généreux dans les cellules de l'en-tête *@
                    <th scope="col" class="p-3 text-white">Date Vente</th>
                    <th scope="col" class="p-3 text-white">Statut</th>
                    <th scope="col" class="p-3 text-white">Client</th>
                    <th scope="col" class="p-3 text-white">Actions</th> @* Renommé pour être plus clair *@
                </tr>
            </thead>
            <tbody>
                @foreach (var sale in lastSales)
                {
                    <tr>
                        <td class="align-middle py-3">
                            <span class="badge" style="background-color: var(--accent-color);">@sale.NumeroOp</span>
                        </td>
                        <td class="align-middle py-3">@sale.DateDeVente.ToString("dd/MM/yyyy")</td>
                        <td class="align-middle py-3">
                            @{
                                string statusClass = "bg-secondary"; // Default
                                if (sale.Statut == "Terminé") { statusClass = "bg-success"; }
                                else if (sale.Statut == "En Cours") { statusClass = "bg-warning"; }
                                else if (sale.Statut == "Annulé") { statusClass = "bg-danger"; }
                            }
                            <span class="badge @statusClass text-white fw-bold">@sale.Statut</span> @* bg-*, text-white, fw-bold *@
                        </td>
                        <td class="align-middle py-3">
                            @if (sale.Client != null)
                            {
                                <a href="@Url.Action("Details", "Client", new { id = sale.Client.ID })" 
                                   class="text-decoration-none" 
                                   style="color: var(--accent-color); font-weight: 500;">
                                    @($"{sale.Client.Nom} {sale.Client.Prenom}")
                                </a>
                            }
                            else
                            {
                                <span class="text-danger fw-light fst-italic">Client inconnu</span> @* fst-italic pour italic *@
                            }
                        </td>
                        <td class="align-middle py-3">
                            @Html.ActionLink("Voir détails", "Details", "OperationVente", 
                                new { id = sale.ID }, 
                                new { @class = "btn btn-sm", 
                                      style = "border-color: var(--accent-color); color: var(--accent-color);" })
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="alert bg-white text-center p-4 my-4 shadow-sm rounded-lg border-0" role="alert">
        @* alert, p-4, shadow-sm, rounded-lg *@
        <p class="mb-0 fs-5" style="color: var(--primary-color);">Aucune opération de vente récente à afficher.</p> @* fs-5, text-dark *@
        <small class="text-muted">Commencez par enregistrer une nouvelle vente pour la voir apparaître ici.</small>
    </div>
}

<style>
    .hover-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .hover-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
    }

    .btn {
        transition: all 0.3s ease;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .table tbody tr {
        transition: background-color 0.3s ease;
    }

    .table tbody tr:hover {
        background-color: rgba(52, 152, 219, 0.05);
    }

    .badge {
        padding: 0.5em 1em;
        font-weight: 500;
    }
</style>

@section Scripts {
    <script>
        // Animation d'entrée pour les cartes
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
}